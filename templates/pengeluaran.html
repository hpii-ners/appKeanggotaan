{% extends "base.html" %}

{% block content %}
<div class="row animate__animated animate__fadeIn">
    <div class="col-md-12 mb-4 d-flex justify-content-between align-items-center">
        <button type="button" class="btn btn-danger px-4 shadow-sm fw-bold" data-bs-toggle="modal" data-bs-target="#modalKeluar">
            <i class="bi bi-dash-circle me-2"></i>Catat Pengeluaran
        </button>
        <h4 class="fw-bold text-danger mb-0">CATATAN PENGELUARAN KAS</h4>
    </div>

    <div class="col-md-12">
        <div class="card shadow-sm border-0 p-4 text-dark">
            <div class="table-responsive">
                <table class="table table-hover w-100 align-middle" id="tablePengeluaran">
                    <thead class="text-secondary">
                        <tr>
                            <th scope="col">TANGGAL</th>
                            <th scope="col">KETERANGAN</th>
                            <th scope="col">NOMINAL</th>
                            <th scope="col" class="text-center">AKSI</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for d in data %}
                        <tr>
                            <td class="small">{{ d.tanggal.strftime('%d/%m/%Y') }}</td>
                            <td class="fw-bold">{{ d.keterangan }}</td>
                            <td class="text-danger fw-bold">Rp {{ "{:,.0f}".format(d.jumlah).replace(',', '.') }}</td>
                            <td class="text-center">
                                <button class="btn btn-sm btn-outline-warning border-0 btn-edit" 
                                        data-id="{{ d.id }}" data-ket="{{ d.keterangan }}" 
                                        data-jumlah="{{ d.jumlah }}" data-tgl="{{ d.tanggal.strftime('%Y-%m-%d') }}">
                                    <i class="bi bi-pencil-square"></i>
                                </button>
                                <a href="/hapus_pengeluaran/{{ d.id }}" class="btn btn-sm btn-outline-danger border-0" onclick="return confirm('Hapus data pengeluaran ini?')">
                                    <i class="bi bi-trash"></i>
                                </a>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block modals %}
<div class="modal fade" id="modalKeluar" tabindex="-1" aria-hidden="true" data-bs-focus="false">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content border-0 shadow-lg">
            <form action="/pengeluaran" method="POST">
                <div class="modal-header bg-danger text-white border-0">
                    <h5 class="modal-title fw-bold"><i class="bi bi-dash-circle me-2"></i>Catat Pengeluaran Baru</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body p-4">
                    <div class="mb-3">
                        <label class="form-label fw-bold" for="tanggal">Tanggal</label>
                        <input type="date" name="tanggal" class="form-control" required value="{{ date_now }}">
                    </div>
                    <div class="mb-3">
                        <label class="form-label fw-bold" for="keterangan">Keterangan / Deskripsi</label>
                        <textarea name="keterangan" class="form-control" rows="3" required placeholder="Contoh: Pembayaran Gaji Security"></textarea>
                    </div>
                    <div class="mb-3">
                        <label class="form-label fw-bold text-danger" for="jumlah">Jumlah (Rp)</label>
                        <input type="number" name="jumlah" class="form-control form-control-lg fw-bold border-danger" required>
                    </div>
                </div>
                <div class="modal-footer border-0">
                    <button type="submit" class="btn btn-danger w-100 py-2 fw-bold shadow">Simpan Data Pengeluaran</button>
                </div>
            </form>
        </div>
    </div>
</div>

<div class="modal fade" id="modalEditKeluar" tabindex="-1" aria-hidden="true" data-bs-focus="false">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content border-0 shadow-lg">
            <form id="formEditKeluar" method="POST">
                <div class="modal-header bg-warning border-0">
                    <h5 class="modal-title fw-bold"><i class="bi bi-pencil-square me-2"></i>Edit Pengeluaran</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body p-4 text-dark">
                    <div class="mb-3">
                        <label class="form-label fw-bold text-dark" for="edit_k_tanggal">Tanggal</label>
                        <input type="date" id="edit_k_tanggal" name="tanggal" class="form-control text-dark bg-white" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label fw-bold text-dark" for="edit_k_keterangan">Keterangan</label>
                        <input type="text" id="edit_k_keterangan" name="keterangan" class="form-control text-dark bg-white" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label fw-bold text-dark" for="edit_k_jumlah">Jumlah (Rp)</label>
                        <input type="number" id="edit_k_jumlah" name="jumlah" class="form-control text-dark bg-white fw-bold" required>
                    </div>
                </div>
                <div class="modal-footer border-0">
                    <button type="submit" class="btn btn-warning w-100 fw-bold py-2 shadow">Update Pengeluaran</button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="https://code.jquery.com/jquery-3.7.0.js"></script>
<script>
$(document).ready(function() {
    $('.btn-edit').on('click', function() {
        const id = $(this).data('id');
        const ket = $(this).data('ket');
        const jumlah = $(this).data('jumlah');
        const tgl = $(this).data('tgl');

        $("#edit_k_keterangan").val(ket);
        $("#edit_k_jumlah").val(jumlah);
        $("#edit_k_tanggal").val(tgl);
        $("#formEditKeluar").attr("action", "/edit_pengeluaran/" + id);
        
        const editModal = new bootstrap.Modal(document.getElementById('modalEditKeluar'));
        editModal.show();
    });
});
</script>
{% endblock %}